# Розділ 3: Функціональні вимоги

Цей розділ детально описує функціональність продукту, розділену на ключові модулі. Вимоги пріоритезовані для поетапної реалізації, починаючи з Мінімально Життєздатного Продукту (MVP).

## 3.1. Ключові Модулі (MVP)

### 3.1.1. Управління Клієнтами (Контакти та Компанії)

Цей модуль є ядром CRM і дозволяє централізовано зберігати всю інформацію про клієнтів.

**Сутності (Entities):**

*   **Контакт (Contact) — фізична особа:**
    *   `ПІБ` (обов'язкове поле)
    *   `Телефон` (основний + додаткові)
    *   `Email` (основний + додаткові)
    *   `Компанія` (зв'язок із сутністю `Company`)
    *   `Посада`
    *   `Теги` (для гнучкої сегментації)
    *   `Джерело ліда` (наприклад, "сайт", "рекомендація")
    *   `Відповідальний` (прив'язка до менеджера `user_id`)
    *   `Статус` (нов-ий, кваліфікований, клієнт, втрачений)
    *   `Дата створення / оновлення`
    *   `Custom fields` (кастомні поля у форматі JSON для гнучкості)

*   **Компанія (Company) — юридична особа:**
    *   `Назва` (обов'язкове поле)
    *   `ЄДРПОУ/ІПН`
    *   `Адреса` (юридична, фактична)
    *   `Телефон / Email`
    *   `Сайт`
    *   `Теги`
    *   `Відповідальний`
    *   `Статус`
    *   `Custom fields`

**Функціональність:**

*   **CRUD-операції:** Створення, читання, оновлення та видалення контактів і компаній.
*   **Видалення/Архівація:** Для збереження цілісності даних (наприклад, історії замовлень), видалення реалізується через механізм "м'якого видалення" (soft delete), позначаючи запис як архівний, а не стираючи його фізично.
*   **Швидкий пошук та фільтрація:** Миттєвий пошук за іменем, телефоном, email. Можливість фільтрувати списки за статусом, тегами, відповідальним менеджером.
*   **Історія взаємодій (Timeline):** Детальний перегляд історії всіх контактів з клієнтом: замовлення, завдання, нотатки, дзвінки.
*   **Імпорт/Експорт (Post-MVP):** Можливість масового імпорту клієнтів з CSV/Excel та експорту даних для аналітики або перенесення.
*   **Масові операції:** Можливість змінювати статус або призначати відповідального для кількох клієнтів одночасно.

### 3.1.2. Управління Угодами (Deals & Pipeline)

Цей модуль дозволяє візуалізувати та керувати процесом продажів від першого контакту до успішного закриття угоди.

**Сутності:**

*   **Угода (Deal):**
    *   `Назва`
    *   `Контакт/Компанія` (зв'язок)
    *   `Сума`
    *   `Валюта` (UAH, USD, EUR)
    *   `Етап воронки` (`stage_id`)
    *   `Ймовірність закриття` (%)
    *   `Очікувана дата закриття`
    *   `Відповідальний`
    *   `Теги`
    *   `Продукти/послуги` (зв'язок "багато до багатьох")
    *   `Джерело`
    *   `Дати створення / закриття`
    *   `Custom fields`

*   **Воронка продажів (Pipeline):**
    *   `Назва` (наприклад, "Основні продажі", "Сервісне обслуговування")
    *   `Етапи` (масив об'єктів `stages`):
        *   `id`, `name`, `order`, `probability`, `color`
        *   Дефолтні етапи: Лід → Кваліфікація → Пропозиція → Переговори → Закрито (успішно/програно)
        *   Можливість повної кастомізації етапів.

**Функціональність:**

*   **Kanban-дошка:** Інтерактивна дошка для візуального керування угодами та їх переміщення між етапами за допомогою drag-and-drop.
*   **CRUD угод:** Повний набір операцій для створення та редагування угод.
*   **Життєвий цикл:** Угоди мають чіткий життєвий цикл (наприклад, "Чернетка", "Відкрита", "Виграна", "Програна"). Жорстке видалення угод не допускається для збереження фінансової історії; замість цього використовується статус "Скасовано".
*   **Фільтрація та прогнозування:** Фільтри за етапом, відповідальним, сумою. Автоматичний прогноз продажів (сума * ймовірність).
*   **Історія та нотифікації:** Відстеження історії змін етапів та надсилання сповіщень відповідальним при ключових змінах.

### 3.1.3. Управління Завданнями (Tasks)

Модуль для планування та відстеження всіх справ, пов'язаних з клієнтами та угодами.

**Сутності:**

*   **Завдання (Task):**
    *   `Назва`
    *   `Опис`
    *   `Тип` (дзвінок, зустріч, email, todo)
    *   `Пріоритет` (низький, середній, високий)
    *   `Статус` (заплановано, в роботі, виконано, скасовано)
    *   `Дедлайн` (дата + час)
    *   `Відповідальний` (`assigned_to`)
    *   `Створено ким` (`created_by`)
    *   `Зв'язані сутності` (`contact_id`, `deal_id`)
    *   `Результат` (текстове поле для фіксації підсумків)

**Функціональність:**

*   **Створення завдань:** Швидке створення завдань з будь-якого модуля (з картки клієнта, угоди).
*   **Календар та списки:** Відображення завдань у вигляді календаря (день, тиждень, місяць) та списку з можливістю сортування та фільтрації.
*   **Нагадування:** Автоматичні нагадування (push-сповіщення, email) про наближення дедлайну.
*   **Швидке виконання:** Можливість відмітити завдання як виконане одним кліком, особливо з мобільного пристрою.

### 3.1.4. Продукти та Послуги (Products)

Легкий каталог товарів та послуг для прискорення створення угод.

**Сутності:**

*   **Продукт (Product/Service):**
    *   `Назва`
    *   `Артикул (SKU)`
    *   `Опис`
    *   `Ціна`
    *   `Одиниця виміру`
    *   `Категорія`
    *   `Статус` (активний/неактивний)

**Функціональність:**

*   **CRUD операції** та ієрархічні категорії.
*   **Швидкий пошук:** Миттєвий пошук та додавання продуктів при оформленні угоди.
*   **Для MVP:** Якщо реалізація повноцінного каталогу ускладнена, угоди підтримуватимуть додавання позицій у вільному текстовому форматі (опис, кількість, ціна).

### 3.1.5. Базова Аналітика (Analytics)

Ключові показники ефективності на одному дашборді.

*   **Дашборд:**
    *   Конверсія воронки продажів (%).
    *   Кількість та сума угод по етапах.
    *   Виконання плану продажів.
    *   Топ-менеджери за сумою/кількістю угод.
    *   Розподіл угод за джерелами.
*   **Звіти:** Базові звіти по угодах, задачах та клієнтах з можливістю експорту в CSV.

## 3.2. Вимоги до Інтеграцій

### 3.2.1. Інтеграція з «Нова Пошта»
*   **Генерація ТТН:** Система дозволяє створювати експрес-накладні (ТТН) безпосередньо з картки угоди, відправляючи дані про відправлення (вага, габарити, адреса) через API «Нова Пошта». Згенерований номер ТТН автоматично зберігається в даних угоди.
*   **Друк маркування:** Після створення ТТН користувач може отримати та роздрукувати маркування (етикетку) для посилки у форматі PDF.
*   **Відстеження статусу:** Система дозволяє відстежувати поточний статус доставки за номером ТТН. В майбутньому можлива реалізація фонового оновлення статусів.
*   **Автозаповнення (Post-MVP):** Для покращення UX буде додано автозаповнення міст та відділень «Нова Пошта» при оформленні доставки.

### 3.2.2. Комунікації (Email/SMS)
*   **Email-сповіщення:** Система надає можливість надсилати клієнтам транзакційні email-повідомлення (наприклад, підтвердження замовлення, статус доставки). Для MVP реалізується відправка шаблонного листа по кліку на кнопку.
*   **SMS-сповіщення (Post-MVP):** Архітектура передбачає можливість підключення SMS-шлюзів для відправки сповіщень клієнтам. Ця функція буде реалізована як додатковий платний модуль.

## 3.3. Управління Користувачами та Автентифікація

*   **Реєстрація та вхід:** Користувачі можуть реєструватися за допомогою email та пароля. Система підтримує логін через "магічне посилання" (magic link) для зручності на мобільних пристроях.
*   **Створення організації:** При реєстрації першого користувача автоматично створюється нова організація (робочий простір), а користувач отримує роль "Власник".
*   **Запрошення користувачів:** Власник або Адміністратор може запрошувати нових членів команди в організацію. Процес виглядає наступним чином:
    1.  Адміністратор вказує email та роль майбутнього користувача.
    2.  Система генерує унікальне, безпечне посилання-запрошення з обмеженим терміном дії (наприклад, 48 годин) і надсилає його на вказаний email.
    3.  Користувач переходить за посиланням. Якщо запрошення дійсне, він може приєднатися до організації. Якщо у користувача ще немає акаунту в системі, йому буде запропоновано зареєструватися.
    4.  Адміністратор може переглядати список активних запрошень, скасовувати їх або надсилати повторно.
*   **Відновлення пароля:** Функціонал "Забули пароль?" реалізовано через стандартні механізми Supabase Auth.
*   **Ізоляція даних (Multi-Tenancy):** Кожен запит до даних на сервері та в базі даних (через RLS) жорстко фільтрується за `organization_id`, що гарантує повну ізоляцію даних між різними компаніями.

## 3.4. Інші Функціональні Аспекти

*   **Офлайн-режим:** Ключова функція, що дозволяє користувачеві:
    *   Переглядати раніше завантажені дані (клієнтів, угод) без доступу до мережі.
    *   Створювати нові записи (наприклад, контакти чи угоди), які зберігаються локально і автоматично синхронізуються з сервером при відновленні з'єднання.
*   **Інтернаціоналізація (i18n):** На рівні коду всі текстові рядки виносяться в словники, що дозволить у майбутньому легко додати підтримку інших мов (наприклад, англійської).
*   **Підтримка White-label (Post-MVP):** Архітектура передбачає можливість кастомізації інтерфейсу (логотип, кольорова схема) для преміум-клієнтів.
*   **Відкритий API (Post-MVP):** Внутрішній дизайн API розробляється з урахуванням того, що в майбутньому він може бути частково відкритий для сторонніх розробників.

## 3.5. Додаткові Модулі (Post-MVP)

*   **Інтеграція з Email/SMS (розширена):** Підключення пошти (IMAP/SMTP) та SMS-шлюзів для автоматизації комунікацій.
*   **Інтеграція з «Нова Пошта» (розширена):** Автоматичне відстеження статусів, автозаповнення адрес.
*   **Автоматизація (Workflows):** Створення ланцюжків автоматичних дій на основі тригерів (подія → дія).
*   **Документи та Фінанси:** Генерація рахунків, договорів, актів на основі шаблонів та інтеграція з банківськими API (Monobank, ПриватБанк).
*   **Відкритий API та Marketplace:** Надання API для сторонніх розробників для створення власних інтеграцій та модулів.

## 3.6. Пріоритезація функцій (MoSCoW)

| Must Have (MVP) | Should Have (v1.5) | Could Have (v2.0) | Won't Have (поки) |
|---|---|---|---|
| Керування Клієнтами (CRUD) | Email-інтеграція | Маркетингові кампанії | CRM для HoReCa |
| Керування Компаніями (CRUD) | SMS-інтеграція | Складський облік | Функції ERP |
| Угоди + Kanban-дошка | Інтеграція з «Нова Пошта» | Проєктний менеджмент | Бухгалтерський облік |
| Завдання + Календар | Генерація документів | Інтеграція з телефонією | HR-модуль |
| Каталог продуктів (базовий) | Виставлення рахунків | API для розробників | |
| Базова аналітика (дашборд) | База знань | Marketplace додатків | |
| Керування користувачами та ролями | Розширені звіти | White-label рішення | |
| Мобільний PWA з офлайн-синхронізацією | Імпорт з інших CRM | | |
